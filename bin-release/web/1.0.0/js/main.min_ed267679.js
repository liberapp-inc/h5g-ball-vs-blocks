var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},BLOCKS_IN_WIDTH=4,BLOCK_SIZE_PER_WIDTH=1/BLOCKS_IN_WIDTH,BALL_SIZE_PER_WIDTH=BLOCK_SIZE_PER_WIDTH/2,Main=function(e){function t(){var t=e.call(this)||this;return t.once(egret.Event.ADDED_TO_STAGE,t.addToStage,t),t}return __extends(t,e),t.prototype.addToStage=function(){GameObject.initial(this.stage),Game.init(),egret.startTick(this.tickLoop,this)},t.prototype.tickLoop=function(e){return GameObject.process(),!1},t}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var Game=function(){function e(){}return e.init=function(){this.height=egret.MainContext.instance.stage.stageHeight,this.width=egret.MainContext.instance.stage.stageWidth,new Background,new Ball,new BlockWave,new Score},e.random=function(e,t){return e+Math.random()*(t-e)},e.randomInt=function(e,t){return Math.floor(e+Math.random()*(t+.999-e))},e.clamp=function(e,t,i){return t>e&&(e=t),e>i&&(e=i),e},e.color=function(e,t,i){return 65536*Math.floor(255*e)+256*Math.floor(255*t)+Math.floor(255*i)},e.newTextField=function(t,i,s,a,h,n){var r=new egret.TextField;return r.text=t,r.bold=n,r.size=i,r.textColor=s,r.x=(e.width-r.width)*a,r.y=(e.height-r.height)*h,r},e}();__reflect(Game.prototype,"Game");var GameObject=function(){function e(){this.shape=null,e.objects.push(this)}return e.prototype.destroy=function(){this.deleteFlag=!0},e.prototype.onDestroy=function(){},e.initial=function(t){e.objects=[],e.display=t},e.process=function(){e.objects.forEach(function(e){return e.update()}),e.objects=e.objects.filter(function(e){return e.deleteFlag&&e["delete"](),!e.deleteFlag}),e.transit&&(e.dispose(),e.transit(),e.transit=null)},e.dispose=function(){e.objects.forEach(function(e){e.destroy(),e["delete"]()}),e.objects=e.objects.filter(function(e){return!1}),e.objects=[]},e.prototype["delete"]=function(){this.onDestroy(),this.shape&&(e.display.removeChild(this.shape),this.shape=null)},e}();__reflect(GameObject.prototype,"GameObject");var Ball=function(e){function t(){var i=e.call(this)||this;return i.defaultHp=8,i.touchOffsetX=0,i.stopFlag=!1,i.invincible=0,t.I=i,i.hp=i.defaultHp,i.radiusPerHp=Game.width*BALL_SIZE_PER_WIDTH*.5/i.defaultHp,i.radius=i.radiusPerHp*i.hp,i.speed=i.maxSpeed=Game.height/180,i.setShape(.5*Game.width,.7*Game.height,i.radius),GameObject.display.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){return i.touchBegin(e)},i),GameObject.display.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,function(e){return i.touchMove(e)},i),i}return __extends(t,e),t.prototype.onDestroy=function(){var e=this;GameObject.display.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){return e.touchBegin(t)},this),GameObject.display.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,function(t){return e.touchMove(t)},this),t.I=null},t.prototype.setShape=function(e,t,i){this.shape&&GameObject.display.removeChild(this.shape),this.shape=new egret.Shape,this.shape.graphics.beginFill(16760832),this.shape.graphics.drawCircle(0,0,i),this.shape.graphics.endFill(),GameObject.display.addChild(this.shape),this.shape.x=e,this.shape.y=t},t.prototype.update=function(){this.stopFlag&&(this.stopFlag=!1,this.speed=0),this.hp<=0||(this.speed+=Game.clamp(this.maxSpeed-this.speed,0,.1*this.maxSpeed),this.shape.y+=Game.clamp(.7*Game.height-this.shape.y,-1,1),this.invincible>0&&(this.invincible-=1,this.shape.alpha=0===(4&this.invincible)?1:.5))},t.prototype.touchBegin=function(e){this.hp<=0||(this.touchOffsetX=this.shape.x-e.localX)},t.prototype.touchMove=function(e){this.hp<=0||(this.shape.x=e.localX+this.touchOffsetX,this.shape.x=Game.clamp(this.shape.x,this.radius,Game.width-this.radius),this.touchOffsetX=this.shape.x-e.localX)},t.prototype.conflict=function(e,t){return this.shape.x+=e,this.shape.x=Game.clamp(this.shape.x,this.radius,Game.width-this.radius),this.shape.y+=t,this.touchOffsetX+=e,t>0&&(this.stopFlag=!0),this.invincible<=0?(this.invincible=15,this.hp=this.hp-1,this.hp<=0?(new GameOver,this.stopFlag=!0,!0):(this.radius=this.radiusPerHp*this.hp,this.setShape(this.shape.x,this.shape.y,this.radius),!0)):!1},t.prototype.eatDot=function(){this.hp+=1,this.radius=this.radiusPerHp*this.hp,this.setShape(this.shape.x,this.shape.y,this.radius)},t.I=null,t}(GameObject);__reflect(Ball.prototype,"Ball");var Block=function(e){function t(t,i,s){var a=e.call(this)||this;return a.size=Game.width*BLOCK_SIZE_PER_WIDTH*.95,a.hp=s,a.setShape(t,i),a}return __extends(t,e),t.prototype.setShape=function(e,i){this.shape&&GameObject.display.removeChild(this.shape),this.shape=new egret.Shape,this.shape.graphics.beginFill(t.getColor(this.hp)),this.shape.graphics.drawRect(-.5*this.size,-.5*this.size,this.size,this.size),this.shape.graphics.endFill(),GameObject.display.addChild(this.shape),GameObject.display.setChildIndex(this.shape,2),this.shape.x=e,this.shape.y=i},t.prototype.update=function(){this.shape.y+=Ball.I.speed;var e=Ball.I.shape.x-this.shape.x,t=Ball.I.shape.y-this.shape.y,i=Ball.I.radius+.5*this.size,s=e*e,a=t*t,h=i*i;h>s&&h>a&&(a>s&&t>0?Ball.I.conflict(0,i-t+.2*Ball.I.maxSpeed)&&(this.hp-=1,this.setShape(this.shape.x,this.shape.y),this.hp<=0&&this.destroy()):Ball.I.conflict((e>0?i:-i)-e,0)),this.shape.y>=Game.height+.5*this.size&&this.destroy()},t.getColor=function(e){var i=.7*Game.clamp((e-1)/(t.maxHp-1),0,1)+.3;return Game.color(i,1-i,1-.25*i)},t.maxHp=8,t}(GameObject);__reflect(Block.prototype,"Block");var DotEnergy=function(e){function t(t,i){var s=e.call(this)||this;return s.radius=Game.width*BALL_SIZE_PER_WIDTH*.5*.5,s.shape=new egret.Shape,s.shape.graphics.beginFill(16760832),s.shape.graphics.drawCircle(0,0,s.radius),s.shape.graphics.endFill(),GameObject.display.addChild(s.shape),s.shape.x=t,s.shape.y=i,s}return __extends(t,e),t.prototype.update=function(){this.shape.y+=Ball.I.speed;var e=Ball.I.shape.x-this.shape.x,t=Ball.I.shape.y-this.shape.y,i=Ball.I.radius+this.radius;i*i>e*e+t*t&&(Ball.I.eatDot(),this.destroy()),this.shape.y>=Game.height&&this.destroy()},t}(GameObject);__reflect(DotEnergy.prototype,"DotEnergy");var BlockWave=function(e){function t(){var t=e.call(this)||this;return t.progress=0,t}return __extends(t,e),t.prototype.update=function(){var e=Game.width*BLOCK_SIZE_PER_WIDTH,t=.5*e;if(this.progress+=Ball.I.speed,this.progress>=2*e)if(this.progress-=2*e,0===Game.randomInt(0,1))for(var i=0;BLOCKS_IN_WIDTH>i;i++)Game.randomInt(0,2)>0&&new Block(t+e*i,-t,Game.randomInt(1,Block.maxHp));else{var i=Game.randomInt(0,BLOCKS_IN_WIDTH);new Block(t+e*i,-t,Game.randomInt(1,Block.maxHp)),0===Game.randomInt(0,3)&&(i=(i+Game.randomInt(1,BLOCKS_IN_WIDTH-1))%BLOCKS_IN_WIDTH,new DotEnergy(t+e*i,-t))}},t}(GameObject);__reflect(BlockWave.prototype,"BlockWave");var Background=function(e){function t(){var t=e.call(this)||this;return t.shape=new egret.Shape,t.shape.graphics.beginFill(0),t.shape.graphics.drawRect(0,0,Game.width,Game.height),t.shape.graphics.endFill(),GameObject.display.addChild(t.shape),t}return __extends(t,e),t.prototype.update=function(){},t}(GameObject);__reflect(Background.prototype,"Background");var Score=function(e){function t(){var i=e.call(this)||this;return i.text=null,t.point=0,i.text=Game.newTextField("SCORE : 0",Game.width/18,16776960,.5,0,!0),GameObject.display.addChild(i.text),i}return __extends(t,e),t.prototype.onDestroy=function(){GameObject.display.removeChild(this.text),this.text=null},t.prototype.update=function(){t.point+=Ball.I.speed/(Game.width*BLOCK_SIZE_PER_WIDTH),this.text.text="SCORE : "+t.point.toFixed()},t}(GameObject);__reflect(Score.prototype,"Score");var GameOver=function(e){function t(){var t=e.call(this)||this;return t.textGameOver=null,t.textScore=null,t.textGameOver=Game.newTextField("GAME OVER",Game.width/10,16776960,.5,.45,!0),GameObject.display.addChild(t.textGameOver),t.textScore=Game.newTextField("SCORE : "+Score.point.toFixed(),Game.width/12,16776960,.5,.55,!0),GameObject.display.addChild(t.textScore),GameObject.display.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){return t.tap(e)},t),t}return __extends(t,e),t.prototype.onDestroy=function(){var e=this;GameObject.display.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){return e.tap(t)},this),GameObject.display.removeChild(this.textGameOver),this.textGameOver=null,GameObject.display.removeChild(this.textScore),this.textScore=null},t.prototype.update=function(){},t.prototype.tap=function(e){this.deleteFlag||(GameObject.transit=Game.init,this.destroy())},t}(GameObject);__reflect(GameOver.prototype,"GameOver");