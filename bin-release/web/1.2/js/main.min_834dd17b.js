var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);i.prototype=e.prototype,t.prototype=new i},BLOCKS_IN_WIDTH=4,BLOCK_SIZE_PER_WIDTH=1/BLOCKS_IN_WIDTH,BALL_SIZE_PER_WIDTH=BLOCK_SIZE_PER_WIDTH/2,Main=function(t){function e(){var e=t.call(this)||this;return e.once(egret.Event.ADDED_TO_STAGE,e.addToStage,e),e}return __extends(e,t),e.prototype.addToStage=function(){GameObject.initial(this.stage),Util.init(),Game.init(),egret.startTick(this.tickLoop,this)},e.prototype.tickLoop=function(t){return GameObject.process(),!1},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var Util=function(){function t(){}return t.init=function(){this.height=egret.MainContext.instance.stage.stageHeight,this.width=egret.MainContext.instance.stage.stageWidth},t.random=function(t,e){return t+Math.random()*(e-t)},t.randomInt=function(t,e){return Math.floor(t+Math.random()*(e+.999-t))},t.clamp=function(t,e,i){return e>t&&(t=e),t>i&&(t=i),t},t.color=function(t,e,i){return 65536*Math.floor(255*t)+256*Math.floor(255*e)+Math.floor(255*i)},t.newTextField=function(e,i,s,a,n,h){var r=new egret.TextField;return r.text=e,r.bold=h,r.size=i,r.textColor=s,r.x=(t.width-r.width)*a,r.y=(t.height-r.height)*n,r},t}();__reflect(Util.prototype,"Util");var Game=function(){function t(){}return t.init=function(){new Background,new Ball,new BlockWave,new Score,new StartMessage},t}();__reflect(Game.prototype,"Game");var GameObject=function(){function t(){this.shape=null,t.objects.push(this)}return t.prototype.destroy=function(){this.deleteFlag=!0},t.prototype.onDestroy=function(){},t.initial=function(e){t.objects=[],t.display=e},t.process=function(){t.objects.forEach(function(t){return t.update()}),t.objects=t.objects.filter(function(t){return t.deleteFlag&&t["delete"](),!t.deleteFlag}),t.transit&&(t.dispose(),t.transit(),t.transit=null)},t.dispose=function(){t.objects=t.objects.filter(function(t){return t.destroy(),t["delete"](),!1})},t.prototype["delete"]=function(){this.onDestroy(),this.shape&&(t.display.removeChild(this.shape),this.shape=null)},t}();__reflect(GameObject.prototype,"GameObject");var Ball=function(t){function e(){var i=t.call(this)||this;return i.defaultHp=8,i.touchOffsetX=0,i.stopFlag=!0,i.invincible=0,i.started=!1,e.I=i,i.hp=i.defaultHp,i.radiusPerHp=Util.width*BALL_SIZE_PER_WIDTH*.5/i.defaultHp,i.radius=i.radiusPerHp*i.hp,i.maxSpeed=Util.height/180,i.speed=0,i.setShape(.5*Util.width,.7*Util.height,i.radius),GameObject.display.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){return i.touchBegin(t)},i),GameObject.display.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,function(t){return i.touchMove(t)},i),i}return __extends(e,t),e.prototype.onDestroy=function(){var t=this;GameObject.display.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){return t.touchBegin(e)},this),GameObject.display.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,function(e){return t.touchMove(e)},this),e.I=null},e.prototype.setShape=function(t,e,i){this.shape&&GameObject.display.removeChild(this.shape),this.shape=new egret.Shape,this.shape.graphics.beginFill(16760832),this.shape.graphics.drawCircle(0,0,i),this.shape.graphics.endFill(),GameObject.display.addChild(this.shape),this.shape.x=t,this.shape.y=e},e.prototype.update=function(){this.hp<=0||0==this.started||(this.stopFlag&&(this.stopFlag=!1,this.speed=0),this.speed+=Util.clamp(this.maxSpeed-this.speed,0,.1*this.maxSpeed),this.shape.y+=Util.clamp(.7*Util.height-this.shape.y,-1,1),this.invincible>0&&(this.invincible-=1,this.shape.alpha=0===(4&this.invincible)?1:.5))},e.prototype.touchBegin=function(t){this.hp<=0||(this.touchOffsetX=this.shape.x-t.localX)},e.prototype.touchMove=function(t){this.hp<=0||(this.shape.x=t.localX+this.touchOffsetX,this.shape.x=Util.clamp(this.shape.x,this.radius,Util.width-this.radius),this.touchOffsetX=this.shape.x-t.localX)},e.prototype.conflict=function(t,e){return this.shape.x+=t,this.shape.x=Util.clamp(this.shape.x,this.radius,Util.width-this.radius),this.shape.y+=e,this.touchOffsetX+=t,e>0&&(this.stopFlag=!0),this.invincible<=0?(this.invincible=15,this.hp=this.hp-1,this.hp<=0?(new GameOver,this.stopFlag=!0,this.speed=0,!0):(this.radius=this.radiusPerHp*this.hp,this.setShape(this.shape.x,this.shape.y,this.radius),!0)):!1},e.prototype.eatDot=function(){this.hp+=1,this.radius=this.radiusPerHp*this.hp,this.setShape(this.shape.x,this.shape.y,this.radius)},e.I=null,e}(GameObject);__reflect(Ball.prototype,"Ball");var Block=function(t){function e(e,i,s){var a=t.call(this)||this;return a.size=Util.width*BLOCK_SIZE_PER_WIDTH*.95,a.hp=s,a.setShape(e,i),a}return __extends(e,t),e.prototype.setShape=function(t,i){this.shape&&GameObject.display.removeChild(this.shape),this.shape=new egret.Shape,this.shape.graphics.beginFill(e.getColor(this.hp)),this.shape.graphics.drawRect(-.5*this.size,-.5*this.size,this.size,this.size),this.shape.graphics.endFill(),GameObject.display.addChild(this.shape),GameObject.display.setChildIndex(this.shape,2),this.shape.x=t,this.shape.y=i},e.prototype.update=function(){this.shape.y+=Ball.I.speed;var t=Ball.I.shape.x-this.shape.x,e=Ball.I.shape.y-this.shape.y,i=Ball.I.radius+.5*this.size,s=t*t,a=e*e,n=i*i;n>s&&n>a&&(a>s&&e>0?Ball.I.conflict(0,i-e+.2*Ball.I.maxSpeed)&&(this.hp-=1,this.setShape(this.shape.x,this.shape.y),this.hp<=0&&this.destroy()):Ball.I.conflict((t>0?i:-i)-t,0)),this.shape.y>=Util.height+.5*this.size&&this.destroy()},e.getColor=function(t){var i=.7*Util.clamp((t-1)/(e.maxHp-1),0,1)+.3;return Util.color(i,1-i,1-.25*i)},e.maxHp=8,e}(GameObject);__reflect(Block.prototype,"Block");var DotEnergy=function(t){function e(e,i){var s=t.call(this)||this;return s.radius=Util.width*BALL_SIZE_PER_WIDTH*.5*.5,s.shape=new egret.Shape,s.shape.graphics.beginFill(16760832),s.shape.graphics.drawCircle(0,0,s.radius),s.shape.graphics.endFill(),GameObject.display.addChild(s.shape),s.shape.x=e,s.shape.y=i,s}return __extends(e,t),e.prototype.update=function(){this.shape.y+=Ball.I.speed;var t=Ball.I.shape.x-this.shape.x,e=Ball.I.shape.y-this.shape.y,i=Ball.I.radius+this.radius;i*i>t*t+e*e&&(Ball.I.eatDot(),this.destroy()),this.shape.y>=Util.height&&this.destroy()},e}(GameObject);__reflect(DotEnergy.prototype,"DotEnergy");var BlockWave=function(t){function e(){var e=t.call(this)||this;return e.progress=0,e}return __extends(e,t),e.prototype.update=function(){var t=Util.width*BLOCK_SIZE_PER_WIDTH,e=.5*t;if(this.progress+=Ball.I.speed,this.progress>=2*t)if(this.progress-=2*t,0===Util.randomInt(0,1))for(var i=0;BLOCKS_IN_WIDTH>i;i++)Util.randomInt(0,2)>0&&new Block(e+t*i,-e,Util.randomInt(1,Block.maxHp));else{var i=Util.randomInt(0,BLOCKS_IN_WIDTH);new Block(e+t*i,-e,Util.randomInt(1,Block.maxHp)),0===Util.randomInt(0,3)&&(i=(i+Util.randomInt(1,BLOCKS_IN_WIDTH-1))%BLOCKS_IN_WIDTH,new DotEnergy(e+t*i,-e))}},e}(GameObject);__reflect(BlockWave.prototype,"BlockWave");var Background=function(t){function e(){var e=t.call(this)||this;return e.shape=new egret.Shape,e.shape.graphics.beginFill(0),e.shape.graphics.drawRect(0,0,Util.width,Util.height),e.shape.graphics.endFill(),GameObject.display.addChild(e.shape),e}return __extends(e,t),e.prototype.update=function(){},e}(GameObject);__reflect(Background.prototype,"Background");var Score=function(t){function e(){var i=t.call(this)||this;return i.text=null,e.point=0,i.text=Util.newTextField("SCORE : 0",Util.width/18,16776960,.5,0,!0),GameObject.display.addChild(i.text),i}return __extends(e,t),e.prototype.onDestroy=function(){GameObject.display.removeChild(this.text),this.text=null},e.prototype.update=function(){e.point+=Ball.I.speed/(Util.width*BLOCK_SIZE_PER_WIDTH),this.text.text="SCORE : "+e.point.toFixed()},e}(GameObject);__reflect(Score.prototype,"Score");var GameOver=function(t){function e(){var e=t.call(this)||this;return e.textGameOver=null,e.textScore=null,e.textGameOver=Util.newTextField("GAME OVER",Util.width/10,16776960,.5,.45,!0),GameObject.display.addChild(e.textGameOver),e.textScore=Util.newTextField("SCORE : "+Score.point.toFixed(),Util.width/12,16776960,.5,.55,!0),GameObject.display.addChild(e.textScore),GameObject.display.once(egret.TouchEvent.TOUCH_BEGIN,function(t){return e.tap(t)},e),e}return __extends(e,t),e.prototype.onDestroy=function(){GameObject.display.removeChild(this.textGameOver),this.textGameOver=null,GameObject.display.removeChild(this.textScore),this.textScore=null},e.prototype.update=function(){},e.prototype.tap=function(t){GameObject.transit=Game.init,this.destroy()},e}(GameObject);__reflect(GameOver.prototype,"GameOver");var StartMessage=function(t){function e(){var e=t.call(this)||this;return e.texts=[],e.texts[0]=Util.newTextField("ブロックをよけろ！",Util.width/20,16776960,.5,.4,!0),e.texts.forEach(function(t){GameObject.display.addChild(t)}),GameObject.display.once(egret.TouchEvent.TOUCH_BEGIN,function(t){return e.tap(t)},e),e}return __extends(e,t),e.prototype.onDestroy=function(){this.texts.forEach(function(t){GameObject.display.removeChild(t)}),this.texts=null},e.prototype.update=function(){},e.prototype.tap=function(t){Ball.I.started=!0,Ball.I.stopFlag=!1,this.destroy()},e}(GameObject);__reflect(StartMessage.prototype,"StartMessage");